<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Concurrency Control</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-interactiveBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-translucentGray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="5ed8580f-0aca-4814-a323-c5545607a499" class="page sans"><header><h1 class="page-title">Concurrency Control</h1><p class="page-description"></p></header><div class="page-body"><nav id="1a6936f7-f4bc-42ab-8572-849e0e0b4b96" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#eb35529e-959e-47ec-aac9-fa216a89e192">Why is concurrency control needed?</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#97b533b9-faf4-40a0-8f70-be2cf07472d2">Implementing Serializability</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#7b794f75-7cd0-4291-ada8-8b8daa259585">Concurrency Control Using Locks</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#96083405-0758-48ce-82fe-fbceb312b336">Shared Mode:</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#f1551677-23eb-4f3a-9af3-2ef399628abd">Exclusive:</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#4136a632-42da-4677-bd1f-ec1371f35180">Lock manager</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#e3c06979-0a07-46fd-a9a3-caff972f7bdc">Two Phase Locking Protocol</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#c716b988-f8f5-4b3b-9289-b7ccdcaf2f2c">Basic 2PL: </a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#07d4101d-3d8f-4f5d-b8b9-ad1d740e75c4">Conservative 2PL:</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#a018505d-e7e4-4069-a8d2-ea05335649df">Strict 2PL:</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#5145ea7a-77ba-4a9d-a394-c299071a6404">Rigorous 2PL:</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#46247289-efa3-4395-8d1b-eb69862c6fcd">Deadlock</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#47e51186-958f-42db-8417-c55491d349ea">Schema(s) for Deadlock Resolution</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#50865dc8-5617-4994-a9a7-21934894b81f">Wait-Die (Non Preemptive)</a></div><div class="table_of_contents-item table_of_contents-indent-2"><a class="table_of_contents-link" href="#584c62ff-db77-4153-b0ed-f382e40b4fc6">Wound-Wait (Preemptive)</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#45c64456-74ff-4141-84b5-c6fa711debb2">Deadlock Detection</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#92e96d51-7f33-437f-a3dd-f1a68a4c6385">Basic Timestamp Ordering Protocol</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#20a19778-6513-45e7-bb32-63e3bf9847a6">Strict Timestamp Ordering Protocol</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#9b5316ed-a72a-4050-96bd-c6467aad4992">Thomas’s Write Rule</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#4ec3d2b0-a9fc-4e83-b1fd-7f9019bb78b1">Granularity of Data Items</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#89a1bb95-8df8-48f0-b4b0-e63486cad746">Example</a></div></nav><h1 id="eb35529e-959e-47ec-aac9-fa216a89e192" class="">Why is concurrency control needed?</h1><ul id="8bde0e19-8540-47ca-8539-12fd77c3ae66" class="bulleted-list"><li style="list-style-type:disc"><span style="border-bottom:0.05em solid">The Lost Update Problem</span>: This occurs when two transactions that access the same database items have their operations interleaved in a way that makes the value of some database item incorrect.</li></ul><ul id="a22a924d-a7b9-4750-9ebd-d81cc9ee381f" class="bulleted-list"><li style="list-style-type:disc"><span style="border-bottom:0.05em solid">The Temporary Update (or Dirty Read) Problem</span> : This occurs when one transaction updates a database item and then the transaction fails for some reason (see Section 17.1.4). The updated item is accessed by another transaction before it is changed back to its original value.</li></ul><ul id="839aa35c-f6f4-4b62-8761-6eaaf727583b" class="bulleted-list"><li style="list-style-type:disc"><span style="border-bottom:0.05em solid">The Incorrect Summary Problem:</span> If one transaction is calculating an aggregate summary  function on a number of records while other transactions are updating some of these records, the aggregate function may calculate some values before they are updated and others after they are updated.</li></ul><ul id="808c267e-d059-4b3f-9b55-7cfa47cca1b3" class="bulleted-list"><li style="list-style-type:disc">In a DBMS multiple transactions are executed concurrently</li></ul><ul id="4cfd7209-8d39-4db3-8848-5ad4caec4608" class="bulleted-list"><li style="list-style-type:disc">If the transactions - concurrent - more efficient</li></ul><ul id="51af8a3b-695b-42c0-bcda-0051bcad28e1" class="bulleted-list"><li style="list-style-type:disc">For transactions, we consider data items as resources</li></ul><ul id="45cd39df-5510-46b5-aacf-6faa4c99a302" class="bulleted-list"><li style="list-style-type:disc">When multiple transactions access data elements → may destroy consistency</li></ul><h1 id="97b533b9-faf4-40a0-8f70-be2cf07472d2" class="">Implementing Serializability</h1><ul id="62dc4084-4ce8-47cb-a970-0ec9a7c06e1c" class="bulleted-list"><li style="list-style-type:disc">One way to ensure serializability is to allow transactions to access the data items in a mutually exclusive manner</li></ul><ul id="824b6e0e-d10c-4e9b-aa5d-ed1f7127c9a9" class="bulleted-list"><li style="list-style-type:disc">This is to make sure that when one transaction access a data item, no other transaction can modify that data item</li></ul><ul id="03cc6c63-21a7-40df-9b9b-a204dbe0a9f6" class="bulleted-list"><li style="list-style-type:disc">The following techniques can be implemented for mutual exclusion and control concurrency<ul id="df4445be-9499-4e39-8d78-a76455c1e43b" class="bulleted-list"><li style="list-style-type:circle">Lock based protocols</li></ul><ul id="af914dab-e301-438a-bb57-e78bf2b0fbac" class="bulleted-list"><li style="list-style-type:circle">Timestamp based protocols</li></ul></li></ul><ul id="307caf2d-77ce-4618-8dae-e940a47a7778" class="bulleted-list"><li style="list-style-type:disc">Transaction should acquire a lock on a data item before it reads or accesses it and when one is changing the data by having a lock, the other can’t modify it further</li></ul><figure id="644dcaa7-e140-48a9-9663-618c45d7a065" class="image"><a href="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled.png"><img style="width:510px" src="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled.png"/></a></figure><h2 id="7b794f75-7cd0-4291-ada8-8b8daa259585" class="">Concurrency Control Using Locks</h2><h3 id="96083405-0758-48ce-82fe-fbceb312b336" class="">Shared Mode:</h3><ul id="e73520ea-1749-4dba-ba53-2ccaab0495bb" class="bulleted-list"><li style="list-style-type:disc">If a transaction obtains a shared mode lock on a data item Q, it can read Q <span style="border-bottom:0.05em solid">but not modify Q</span></li></ul><ul id="06baa60c-5365-4b3f-8f9f-db522690dda9" class="bulleted-list"><li style="list-style-type:disc">Denoted by S</li></ul><h3 id="f1551677-23eb-4f3a-9af3-2ef399628abd" class="">Exclusive:</h3><ul id="6bdc1694-306e-452c-8626-9e4aba94c5f9" class="bulleted-list"><li style="list-style-type:disc">If this lock is obtained, a transaction can read or write data item </li></ul><ul id="a1f6cd2d-6e5a-42e3-bd90-08613be02a47" class="bulleted-list"><li style="list-style-type:disc">Denoted by X</li></ul><table id="3e524b27-d633-467b-8082-4d6cf7ddc699" class="simple-table"><tbody><tr id="3f8c8b2d-cb13-4398-b5db-b2beca1ec3b0"><td id="EcOp" class=""></td><td id="@jxO" class="">S</td><td id="YOyO" class="">X</td></tr><tr id="9920da11-6c5e-4f1a-a318-7564e7d207c9"><td id="EcOp" class="">S</td><td id="@jxO" class="">true</td><td id="YOyO" class="">false</td></tr><tr id="b540e0b1-03cd-4156-86aa-a294d1b3cf35"><td id="EcOp" class="">X</td><td id="@jxO" class="">false</td><td id="YOyO" class="">false</td></tr></tbody></table><h3 id="4136a632-42da-4677-bd1f-ec1371f35180" class="">Lock manager</h3><ul id="9243647b-19bd-4df0-9f2b-c7c7a4eb6c0d" class="bulleted-list"><li style="list-style-type:disc">Can be implemented as a separate process to which transactions send lock and unlock requests</li></ul><ul id="088c018d-3658-429b-a256-a7715a9e6e54" class="bulleted-list"><li style="list-style-type:disc">Replies to a lock request by sending a lock grant messages → roll back in case of deadlock</li></ul><ul id="18b30568-63ec-4a04-b0b2-8c95f071c899" class="bulleted-list"><li style="list-style-type:disc">Requesting transaction waits until its request is answered</li></ul><ul id="edc2572a-d9ed-4e4f-92fb-450c1fb6085f" class="bulleted-list"><li style="list-style-type:disc">Lock manager maintains a data structure called a lock table to record granted locks and pending requests</li></ul><ul id="5d9750e0-1fa0-4e04-907a-a8442860588b" class="bulleted-list"><li style="list-style-type:disc">The lock table is usually implemented as an in memory hash table indexed on the name of the data item being locked</li></ul><h2 id="e3c06979-0a07-46fd-a9a3-caff972f7bdc" class="">Two Phase Locking Protocol</h2><ul id="3e99ad4d-dfcd-4f4f-8cd4-62e3bbe6bb75" class="bulleted-list"><li style="list-style-type:disc">This is a protocol which ensures conflict serializable schedules</li></ul><ul id="02f334a0-30c5-4204-bfcc-3ef39e1a2201" class="bulleted-list"><li style="list-style-type:disc">Phase 1: Growing Phase<ul id="5885d77f-9969-4301-9f7d-bfcbe0dcdebb" class="bulleted-list"><li style="list-style-type:circle">transaction may obtain locks</li></ul><ul id="85e9a928-2ed2-4649-91f6-b34f00bfdf37" class="bulleted-list"><li style="list-style-type:circle">transaction may not release locks</li></ul></li></ul><ul id="71d06cd2-16a4-413a-82b0-dab2f2ef124f" class="bulleted-list"><li style="list-style-type:disc">Phase 2: Shrinking Phase<ul id="b1e18e6b-f54e-40fa-bc24-687e23269ce3" class="bulleted-list"><li style="list-style-type:circle">transaction may release locks</li></ul><ul id="20c0bdd0-dfde-4300-91c7-74dd926df0f6" class="bulleted-list"><li style="list-style-type:circle">transaction may not obtain locks</li></ul></li></ul><ul id="26b27f3c-bf59-446f-8420-580c0fbc83b4" class="bulleted-list"><li style="list-style-type:disc">Protocol assures serializability</li></ul><ul id="fc26413b-28d1-4f78-a03b-73301e585080" class="bulleted-list"><li style="list-style-type:disc">Two phase locking does not ensure freedom from deadlocks</li></ul><ul id="ef6f4b99-b7d8-4eae-890a-c319a3bb9f31" class="bulleted-list"><li style="list-style-type:disc">Locking and releasing cannot be interleaved</li></ul><h3 id="c716b988-f8f5-4b3b-9289-b7ccdcaf2f2c" class="">Basic 2PL: </h3><ul id="7bd27afb-8e15-4972-8251-6370ba3b1749" class="bulleted-list"><li style="list-style-type:disc">It is deadlock prone</li></ul><h3 id="07d4101d-3d8f-4f5d-b8b9-ad1d740e75c4" class="">Conservative 2PL:</h3><ul id="5e2d2fba-1773-4ead-abee-71a025db5f62" class="bulleted-list"><li style="list-style-type:disc">A transaction requires to lock all its data items before the transaction begins, hence is deadlock free</li></ul><h3 id="a018505d-e7e4-4069-a8d2-ea05335649df" class="">Strict 2PL:</h3><ul id="809759bc-021a-4cf2-bf8d-89076549189a" class="bulleted-list"><li style="list-style-type:disc">A transaction will not release any of it’s exclusive lock before it commits or aborts, hence always recoverable and is most popular</li></ul><h3 id="5145ea7a-77ba-4a9d-a394-c299071a6404" class="">Rigorous 2PL:</h3><ul id="67c4d727-09ac-4873-87c2-e0498e7b01df" class="bulleted-list"><li style="list-style-type:disc">A transaction will not release any of it’s lock(S or X) before it commits or aborts, hence is also recoverable</li></ul><h1 id="46247289-efa3-4395-8d1b-eb69862c6fcd" class="">Deadlock</h1><figure id="6d8cb2dc-4847-4db4-9f87-bb74ff11137c" class="image"><a href="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%201.png"><img style="width:796px" src="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%201.png"/></a></figure><ul id="3a9bec1c-0cec-4e1d-a34f-6e1e97739495" class="bulleted-list"><li style="list-style-type:disc">System is deadlocked if there is a set of transactions such that every transaction in the set is waiting for another transaction in the set</li></ul><ul id="c37623dc-8b21-4d85-a9ba-24c0b0c9b287" class="bulleted-list"><li style="list-style-type:disc">Deadlock prevention protocols ensure that the system will never enter into a deadlock state. Some prevention strategies:<ul id="01308a2e-9f91-4f71-b063-a938230327f0" class="bulleted-list"><li style="list-style-type:circle">Require that each transaction locks all it’s data items before it begins execution</li></ul><ul id="77bdc685-c87c-45c1-94d1-29cc089c6335" class="bulleted-list"><li style="list-style-type:circle">Example: Conservative 2PL</li></ul></li></ul><h2 id="47e51186-958f-42db-8417-c55491d349ea" class="">Schema(s) for Deadlock Resolution</h2><h3 id="50865dc8-5617-4994-a9a7-21934894b81f" class="">Wait-Die (Non Preemptive)</h3><ul id="8ce03465-0148-4190-8bf4-619422a4340f" class="bulleted-list"><li style="list-style-type:disc">If a data item is locked by lower priority transaction, and a higher priority transaction comes, it has to wait but if a lower priority transaction comes, it has to die</li></ul><figure id="8c7efbfa-bcfa-4025-ae0b-20366c447864" class="image"><a href="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%202.png"><img style="width:684px" src="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%202.png"/></a></figure><ul id="4501e52a-4c85-4f5a-9a72-47c9640f15f5" class="bulleted-list"><li style="list-style-type:disc">Here T1 if we count as older, then T2 will get rolled back according to wait-die</li></ul><ul id="0be3b9c0-bcf6-411c-9297-d920edbf2995" class="bulleted-list"><li style="list-style-type:disc">If T2 is older, then T2 when it asks for A, it has to wait and won’t die but when it waits and it goes to T1 and waits for B, it gets rolled back and T2 gets lock on A</li></ul><ul id="1890d108-cdd7-445d-b9ac-00aab04f1d18" class="bulleted-list"><li style="list-style-type:disc">Older transaction may wait for younger one to release data item, but younger transactions never wait for older ones, instead they are rolled back</li></ul><h3 id="584c62ff-db77-4153-b0ed-f382e40b4fc6" class="">Wound-Wait (Preemptive)</h3><ul id="a5c2eab7-f6d2-4a2a-adfb-07f5d2408f94" class="bulleted-list"><li style="list-style-type:disc">If we have the same example but with wound wait protocol</li></ul><figure id="ca5963d8-eb01-4917-85b3-c81e167a2efe" class="image"><a href="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%203.png"><img style="width:684px" src="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%203.png"/></a></figure><ul id="689fb016-30fb-4ff7-b848-3ab71f46ba96" class="bulleted-list"><li style="list-style-type:disc">According to this, when a data item is held by a younger transaction,  if the older comes and asks for a lock, it’ll forcibly kill the other transaction and takes it</li></ul><ul id="fce53d2e-fb8c-4966-87e9-e87f1e75ae01" class="bulleted-list"><li style="list-style-type:disc">If the younger one is asking it’ll have to wait</li></ul><ul id="9a97aebf-3849-47a1-84f7-3c663abf19be" class="bulleted-list"><li style="list-style-type:disc">T1 can get lock on A, T2 is asking for B and it can be given. younger is asking for exclusive lock on A, then it has to wait for T1 but when T1 asks B, it wounds the younger transaction and gets the lock</li></ul><ul id="e0c9c3c7-4cad-4380-9a6c-be4a7cc46ad5" class="bulleted-list"><li style="list-style-type:disc">Older transaction wounds(forces rollback) of younger transaction instead of waiting for it. Younger may wait for older ones</li></ul><h2 id="45c64456-74ff-4141-84b5-c6fa711debb2" class="">Deadlock Detection</h2><ul id="086dddf2-5b2a-49b7-aa95-41e2cc14ce78" class="bulleted-list"><li style="list-style-type:disc">You can use wait-for graph</li></ul><ul id="8969530e-34ea-4373-b1c7-5dc8c7607ced" class="bulleted-list"><li style="list-style-type:disc">All transactions of the schedule become vertices</li></ul><ul id="72c13f1a-7c1e-4796-b34f-73fda632c7ab" class="bulleted-list"><li style="list-style-type:disc">And we have an edge between <code>Ti</code> and <code>Tj</code>. If <code>Ti</code> is waiting for <code>Tj</code> to release a lock on a data item. </li></ul><ul id="62f17f1b-b2e3-4ac8-882a-7b54689841ed" class="bulleted-list"><li style="list-style-type:disc">If the graph has a cycle then we can say that the schedule will result in a deadlock</li></ul><figure id="a511f936-133b-404b-a344-b17c65e2d301" class="image"><a href="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%204.png"><img style="width:1111px" src="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%204.png"/></a></figure><ul id="51a460f9-9e97-43b8-a2a4-5825b846cd5c" class="bulleted-list"><li style="list-style-type:disc">We keep checking, and <span style="border-bottom:0.05em solid">once a operation comes which is waiting for another transaction, it stops there and we don’t go into that column anymore</span></li></ul><ul id="6ece856f-bbf6-476f-8a8a-e1ac746a4d18" class="bulleted-list"><li style="list-style-type:disc">We use the last transaction which locks on that particular variable, for example here T4 waits on T1 for B and not T2 which had it before</li></ul><figure id="f2329731-558d-46a2-b44d-d6a42f6166fd" class="image"><a href="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%205.png"><img style="width:925px" src="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%205.png"/></a></figure><ul id="e1db2bf8-40e6-4a5e-90b4-91fcc4f734ae" class="bulleted-list"><li style="list-style-type:disc">Cycles lead to deadlock</li></ul><h1 id="92e96d51-7f33-437f-a3dd-f1a68a4c6385" class="">Basic Timestamp Ordering Protocol</h1><ul id="942c1ff1-f4d3-498f-8d9f-296ffea2b5b0" class="bulleted-list"><li style="list-style-type:disc">Maintains the ordering between every pair of conflicting transactions is significant</li></ul><ul id="d01c7371-7609-4b1e-8527-33d013c819d9" class="bulleted-list"><li style="list-style-type:disc">If we select the ordering in advance, we can achieve serializability. Time stamping is a method to fix the ordering</li></ul><ul id="d5462d34-fc37-453f-8e10-c57c231d8ae4" class="bulleted-list"><li style="list-style-type:disc">TS(Ti) &lt; TS(Tj) meaning Ti should be executed first</li></ul><ul id="cc9c800e-f596-4dfe-84fa-b43c892f414a" class="bulleted-list"><li style="list-style-type:disc">W-timestamp → largest timestamp of any transaction that successfully executes Write(Q) → data item wise</li></ul><ul id="70f2945b-d993-4c32-8daa-d4fc83ac853e" class="bulleted-list"><li style="list-style-type:disc">R-timestamp → largest timestamp of any transaction that successfully executed Read(Q) → data item wise</li></ul><ul id="ff3ef9c9-ef48-43a6-9447-4fb2d5bbde3b" class="bulleted-list"><li style="list-style-type:disc">These values are updated whenever read(Q) or write(Q) are executed</li></ul><ul id="226ee598-c47c-40a2-a06e-f02903af5361" class="bulleted-list"><li style="list-style-type:disc">The protocol operates as follows:</li></ul><ul id="66274225-267d-4066-8edd-fb7dc656923c" class="bulleted-list"><li style="list-style-type:disc">Suppose Transaction Ti issues read(Q),<ul id="d2734e02-d341-4727-bf62-392332e57a0b" class="bulleted-list"><li style="list-style-type:circle"> if TS(Ti) &lt; W-stamp(Q) then it implies that Ti needs to read Q which was already overwritten, Hence read operation is rejected and Ti is rolled back</li></ul><ul id="a08300ba-9bcd-4e74-a2f8-57ab264f20de" class="bulleted-list"><li style="list-style-type:circle">If TS(Ti) ≥ W-timestamp(Q) then read operation is executed</li></ul><ul id="8fc2e50c-a452-47d5-bb97-90cd3b08272f" class="bulleted-list"><li style="list-style-type:circle">Second situation occurs when we read after the write is executed</li></ul></li></ul><ul id="8aaf5963-d061-4214-8d01-f13cd2d80f82" class="bulleted-list"><li style="list-style-type:disc">Suppose Ti issues write(Q)<ul id="f63acf88-b45f-48ed-98a9-0ccf374ed96a" class="bulleted-list"><li style="list-style-type:circle">If TS(Ti) &lt; R-timestamp(Q) it implies that the value of Q being produced by Ti had to be written long back and hence reject Ti and roll back</li></ul><ul id="3374fc16-728d-4a95-9b9b-c539ca6bfbff" class="bulleted-list"><li style="list-style-type:circle">If TS(Ti) &lt; W-timestamp(Q) Ti is attempting to write some absolute value of Q. Hence reject Ti &amp; roll back. Otherwise write operation is executed.</li></ul><ul id="d0a47840-ba2a-4b6f-8b30-289f0179fbaf" class="bulleted-list"><li style="list-style-type:circle"><span style="border-bottom:0.05em solid"><strong>Note: It is guaranteed to be conflict serializable. But may not be recoverable</strong></span></li></ul></li></ul><figure id="cea1e13a-0871-4b65-b4e0-7a26fe5d5811" class="image"><a href="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%206.png"><img style="width:755px" src="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%206.png"/></a></figure><ul id="d23b5248-fc3d-4ad9-b8bd-ddee0d91e50b" class="bulleted-list"><li style="list-style-type:disc">In case 1, RTS is 300 and WTS is 320 but TS = 450 requesting Read(A), when we are trying to read we are worried about write RS which is 320, and we see 320 &lt; 450. Transaction older than the current transaction has already updated it and the younger one is trying to read so it can be honored</li></ul><ul id="04242cf5-91ed-41ea-bba2-0e8ced524afe" class="bulleted-list"><li style="list-style-type:disc">In case 2, RTS is 500 but WTS is 400 and so we can honor this also</li></ul><ul id="4f30408e-3d27-4a27-adab-c1c13c5d4a5c" class="bulleted-list"><li style="list-style-type:disc">In case 3, RTS is 500 and WTS 480, that means value is being written at 480. 450 is coming early but 480 has already been done, so that means this should be rolled back</li></ul><ul id="04097b59-9131-4bc3-8e61-e3e388467a06" class="bulleted-list"><li style="list-style-type:disc">Same for case 4</li></ul><ul id="c50cba30-bece-4ddf-830b-312b8ae9b1ba" class="bulleted-list"><li style="list-style-type:disc">In the second situation, we have case 1 where RTS is 300 and WTS is 320, but TS is 450, so it’s clear and we can allow</li></ul><ul id="3ee6cd04-7796-473a-9d01-ada73cc8bf61" class="bulleted-list"><li style="list-style-type:disc">In case 2, RTS is 500, and TS is 450 that means the RTS happened earlier which shouldn’t have so this should be rolled back</li></ul><h1 id="20a19778-6513-45e7-bb32-63e3bf9847a6" class="">Strict Timestamp Ordering Protocol</h1><figure id="3963b7c4-35ba-4423-8433-ac0e4ea8967e" class="image"><a href="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%207.png"><img style="width:772px" src="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%207.png"/></a></figure><figure id="c27a718c-a3e5-4c92-8085-f8d6a6e4bcdd" class="image"><a href="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%208.png"><img style="width:1465px" src="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%208.png"/></a></figure><h1 id="9b5316ed-a72a-4050-96bd-c6467aad4992" class="">Thomas’s Write Rule</h1><figure id="a54189ae-b9d5-4d3e-b71c-2e0cf3cd9d84" class="image"><a href="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%209.png"><img style="width:1398px" src="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%209.png"/></a></figure><h1 id="4ec3d2b0-a9fc-4e83-b1fd-7f9019bb78b1" class="">Granularity of Data Items</h1><ul id="0f28935a-b987-4075-91be-fd5ef9920564" class="bulleted-list"><li style="list-style-type:disc">Database level</li></ul><ul id="5616d752-435d-4d1f-bbc5-cdbdd92a320b" class="bulleted-list"><li style="list-style-type:disc">File level</li></ul><ul id="a93d2924-19c1-41c7-9e53-4adf21d80b71" class="bulleted-list"><li style="list-style-type:disc">Block level</li></ul><ul id="6695f345-c2e1-46a8-bb46-17c488fa927f" class="bulleted-list"><li style="list-style-type:disc">Record level</li></ul><ul id="1f92bfbd-2c5f-4581-8023-def32c0f8cec" class="bulleted-list"><li style="list-style-type:disc">Field level</li></ul><h1 id="89a1bb95-8df8-48f0-b4b0-e63486cad746" class="">Example</h1><figure id="8f46318d-6c68-429d-873f-41f8441e8b3e" class="image"><a href="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%2010.png"><img style="width:576px" src="Concurrency%20Control%205ed8580f0aca4814a323c5545607a499/Untitled%2010.png"/></a></figure><ul id="7d2f4e9d-6fb6-4579-b90c-248df91d39d0" class="bulleted-list"><li style="list-style-type:disc">NOTE: Once it gets blocked you don’t proceed in that column → transaction </li></ul><ul id="99775415-e081-4929-a2e7-3e1bfb021658" class="bulleted-list"><li style="list-style-type:disc">It gets blocked meaning it stops there itself</li></ul></div></article></body></html>